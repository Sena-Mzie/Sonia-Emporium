<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Shopping Cart</title>
  <style>
    body {
      font-family: 'Montserrat', sans-serif;
      margin: 0;
      padding: 0;
      color: #1a1a1a;
      background-color: #f8f4ee;
    }

    header {
      background-color: #ffffff;
      padding: 20px 40px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      position: fixed;
      width: 100%;
      top: 0;
      z-index: 1000;
      box-sizing: border-box;
    }

    .logo h1 {
      font-family: 'Cormorant Garamond', serif;
      font-size: 32px;
      color: #333;
      margin: 0;
    }

    nav ul {
      display: flex;
      list-style: none;
      margin: 0;
      padding: 0;
    }

    nav ul li a {
      color: #1a1a1a;
      text-decoration: none;
      padding: 10px 20px;
      font-size: 15px;
      letter-spacing: 1px;
      transition: color 0.3s ease;
    }

    nav ul li a:hover {
      color: #c9a77c;
    }

    .cart-container {
      display: flex;
      justify-content: space-between;
      padding: 160px 40px;
      max-width: 1200px;
      margin: auto;
      gap: 40px;
    }

    /* Cart Items Section */
    .cart-items {
      flex: 2;
      padding: 20px;
      background-color: #fff;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      border-radius: 8px;
    }

    .cart-items h2 {
      font-family: 'Cormorant Garamond', serif;
      font-size: 28px;
      margin-bottom: 20px;
    }

    .cart-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 20px 0;
      border-bottom: 1px solid #ddd;
    }

    .cart-item:last-child {
      border-bottom: none;
    }

    .cart-item img {
      width: 80px;
      height: 80px;
      object-fit: cover;
      border-radius: 4px;
    }

    .cart-item-details {
      flex: 1;
      margin-left: 20px;
    }

    .cart-item-details h4 {
      font-size: 16px;
      color: #333;
      margin: 0;
    }

    .cart-item-details .price {
      font-size: 14px;
      color: #c9a77c;
    }

    .quantity-toggle {
      display: flex;
      align-items: center;
      margin-top: 10px;
    }

    .quantity-toggle button {
      background-color: #f4f4f4;
      border: 1px solid #ddd;
      padding: 5px 10px;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    .quantity-toggle button:hover {
      background-color: #c9a77c;
      color: #fff;
    }

    /* Order Summary Section */
    .cart-summary {
      flex: 1;
      padding: 20px;
      background-color: #fff;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      border-radius: 8px;
    }

    .cart-summary h2 {
      font-family: 'Cormorant Garamond', serif;
      font-size: 24px;
      margin-bottom: 20px;
    }

    .cart-summary p {
      font-size: 18px;
      font-weight: 500;
      color: #555;
      margin-bottom: 10px;
    }

    .cart-summary #totalPrice {
      font-size: 20px;
      color: #c9a77c;
      font-weight: bold;
    }

    .cart-summary button {
      width: 100%;
      padding: 15px;
      background-color: #c9a77c;
      color: white;
      border: none;
      font-size: 16px;
      cursor: pointer;
      border-radius: 8px;
      transition: background-color 0.3s;
    }

    .cart-summary button:hover {
      background-color: #b68e5b;
    }

    footer {
      background-color: #1a1a1a;
      color: white;
      padding: 40px;
      font-size: 14px;
      text-align: center;
    }

    .footer-content {
      display: flex;
      justify-content: space-between;
      max-width: 1200px;
      margin: auto;
    }

    .footer-content ul {
      list-style: none;
      padding: 0;
    }

    .footer-content ul li a {
      color: #c9a77c;
      text-decoration: none;
      font-size: 14px;
      transition: color 0.3s ease;
    }

    .footer-content ul li a:hover {
      color: #fff;
    }

    @media (max-width: 768px) {
      .cart-container {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
 <!--HEADER-->
 <header>
  <div class="logo">
      <h1>SONIA EMPORIUM</h1>
  </div>
  <nav>
      <ul>
          <li><a href="index.html"><i class="fas fa-home"></i> Home</a></li>
          <li><a href="shop.html"><i class="fas fa-shopping-bag"></i> Shop</a></li>
          <li><a href="about.html"><i class="fas fa-info-circle"></i> About</a></li>
          <li><a href="contact.html"><i class="fas fa-phone"></i> Contact</a></li>
          <li><a href="account.html"><i class="fas fa-user"></i> My Account</a></li>
      </ul>
  </nav>
  <div class="cart">
      <a href="cart.html"><i class="fas fa-shopping-cart"></i> Cart </a>
  </div>
</header>

  <div class="cart-container">
    <!-- Cart Items Section -->
    <section class="cart-items">
      <h2>Your Shopping Cart</h2>
      <div id="cartItemsList"></div>
    </section>

    <!-- Order Summary Section -->
    <section class="cart-summary">
      <h2>Order Summary</h2>
      <p id="subtotal">Subtotal: R0.00</p>
      <p id="deliveryFee">Delivery Fee (10%): R0.00</p>
      <h3 id="totalPrice">Total: R0.00</h3>
      <button id="checkoutButton">Proceed to Checkout</button>
    </section>
  </div>

  <footer>
    <div class="footer-content">
        <div class="footer-section about">
            <h3>Our Heritage</h3>
            <p>Since our founding, Sonia Emporium has been synonymous with unparalleled luxury and sophistication in fashion.</p>
        </div>
    </div>
</footer>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.1.2/firebase-app.js";
  import { getFirestore, collection, doc, getDoc, updateDoc, setDoc } from "https://www.gstatic.com/firebasejs/9.1.2/firebase-firestore.js";
  import { getAuth } from "https://www.gstatic.com/firebasejs/9.1.2/firebase-auth.js";

  // Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyCTRQ7Jwg8ro4fGbNpRgY5Xri8KBUju_Cw",
    authDomain: "sonia-emporium-95984.firebaseapp.com",
    projectId: "sonia-emporium-95984",
    messagingSenderId: "582010973914",
    appId: "1:582010973914:web:3bbcc21cef1d15a997ffe3",
    measurementId: "G-72TR5RZVBB",
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);

  // DOM Elements
  const cartItemsList = document.getElementById("cartItemsList");
  const subtotalElem = document.getElementById("subtotal");
  const deliveryFeeElem = document.getElementById("deliveryFee");
  const totalPriceElem = document.getElementById("totalPrice");
  const checkoutButton = document.getElementById("checkoutButton");

  let cartItems = [];
  let subtotal = 0;
  let userId;

  // Fetch cart items
  async function fetchCartItems() {
    try {
      const user = auth.currentUser;
      if (!user) {
        window.location.href = "account.html";
        return;
      }
      userId = user.uid;

      const cartDoc = await getDoc(doc(db, "total items in cart", userId));
      if (!cartDoc.exists()) return [];

      return cartDoc.data().product || [];
    } catch (error) {
      console.error("Error fetching cart items:", error);
      return [];
    }
  }

  // Render cart items
  async function loadCartItems() {
    const products = await fetchCartItems();
    cartItems = products.map((item, index) => ({ ...item, id: index }));
    subtotal = cartItems.reduce((sum, item) => sum + item.price * item.quantity, 0);

    cartItemsList.innerHTML = cartItems.map(createCartItemHTML).join("");
    updateSummary();
  }

  // Generate cart item HTML
  function createCartItemHTML(item, index) {
    return `
      <div class="cart-item">
        <img src="${item.image || "placeholder.jpg"}" alt="${item.name}">
        <div class="cart-item-details">
          <h4>${item.name}</h4>
          <p>Size: ${item.size || "N/A"}</p>
          <p>R${item.price.toFixed(2)}</p>
          <div class="quantity-toggle">
            <button onclick="updateQuantity(${index}, -1)">-</button>
            <span id="quantity-${index}">${item.quantity}</span>
            <button onclick="updateQuantity(${index}, 1)">+</button>
          </div>
        </div>
        <button onclick="removeItem(${index})">Remove</button>
      </div>`;
  }

  // Update summary
  function updateSummary() {
    const deliveryFee = subtotal * 0.1;
    const total = subtotal + deliveryFee;

    subtotalElem.textContent = `Subtotal: R${subtotal.toFixed(2)}`;
    deliveryFeeElem.textContent = `Delivery Fee (10%): R${deliveryFee.toFixed(2)}`;
    totalPriceElem.textContent = `Total: R${total.toFixed(2)}`;
  }

  // Update quantity
  window.updateQuantity = async (index, change) => {
    const item = cartItems[index];
    if (!item) return;

    const newQuantity = Math.max(1, item.quantity + change);
    subtotal += item.price * change;

    cartItems[index].quantity = newQuantity;
    updateCartFirestore(index, { quantity: newQuantity });
    document.getElementById(`quantity-${index}`).textContent = newQuantity;
    updateSummary();
  };

  // Remove item
  window.removeItem = async (index) => {
    const item = cartItems[index];
    if (!item) return;

    subtotal -= item.price * item.quantity;
    cartItems.splice(index, 1);

    await updateCartFirestore(index, null, true);
    loadCartItems();
  };

  // Update Firestore cart
  async function updateCartFirestore(index, updates, remove = false) {
    try {
      const cartDocRef = doc(db, "total items in cart", userId);
      const cartDoc = await getDoc(cartDocRef);

      if (cartDoc.exists()) {
        const products = cartDoc.data().product || [];
        if (remove) products.splice(index, 1);
        else Object.assign(products[index], updates);

        await updateDoc(cartDocRef, { product: products });
      }
    } catch (error) {
      console.error("Error updating cart:", error);
    }
  }

  // Checkout button event listener
checkoutButton.addEventListener("click", () => {
  if (!cartItems.length) {
    alert("Your cart is empty. Please add items to proceed.");
    return;
  }

  // Redirect to the checkout page
  window.location.href = "checkout.html";
});

  // Initialize
  auth.onAuthStateChanged((user) => {
    if (user) loadCartItems();
    else window.location.href = "account.html";
  });
</script>
</body>
</html>