<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Shopping Cart</title>
  <style>
body {
        font-family: 'Montserrat', sans-serif;
        margin: 0;
        padding: 0;
        color: #1a1a1a;
        line-height: 1.6;
        background-color: #f8f4ee;
    }

    /* Header */
    header {
        background-color: #ffffff;
        padding: 20px 40px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        position: fixed;
        width: 100%;
        top: 0;
        z-index: 1000;
        box-sizing: border-box;
    }

    .logo h1 {
        font-family: 'Cormorant Garamond', serif;
        font-size: 32px;
        color: #333;
        margin: 0;
    }

    nav ul {
        display: flex;
        list-style: none;
        margin: 0;
        padding: 0;
    }

    nav ul li a {
        color: #1a1a1a;
        text-decoration: none;
        padding: 10px 20px;
        font-size: 15px;
        letter-spacing: 1px;
        transition: color 0.3s ease;
    }

    nav ul li a:hover {
        color: #c9a77c;
    }

    .cart-container {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 40px;
        padding: 160px 40px;
        max-width: 1200px;
        margin: auto;
    }

    /* Cart Items */
    .cart-items {
        padding: 20px;
        background-color: #fff;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        border-radius: 8px;
    }

    .cart-items h2 {
        font-family: 'Cormorant Garamond', serif;
        font-size: 28px;
        margin-bottom: 20px;
    }

    .cart-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 20px 0;
        border-bottom: 1px solid #ddd;
    }

    .cart-item:last-child {
        border-bottom: none;
    }

    .cart-item img {
        width: 80px;
        height: 80px;
        object-fit: cover;
        border-radius: 4px;
    }

    .cart-item-details {
        flex: 1;
        margin-left: 20px;
    }

    .cart-item-details h4 {
        font-size: 16px;
        color: #333;
        margin: 0;
    }

    .cart-item-details .price {
        font-size: 14px;
        color: #c9a77c;
    }

    .quantity-toggle {
        display: flex;
        align-items: center;
        margin-top: 10px;
    }

    .quantity-toggle button {
        background-color: #f4f4f4;
        border: 1px solid #ddd;
        padding: 5px 10px;
        cursor: pointer;
        transition: background-color 0.3s;
    }

    .quantity-toggle button:hover {
        background-color: #c9a77c;
        color: #fff;
    }

    /* Order Summary */
    .cart-summary {
        padding: 20px;
        background-color: #fff;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        border-radius: 8px;
    }

    .cart-summary h2 {
        font-family: 'Cormorant Garamond', serif;
        font-size: 24px;
        margin-bottom: 20px;
    }

    .cart-summary p {
        font-size: 18px;
        font-weight: 500;
        color: #555;
        margin-bottom: 10px;
    }

    .cart-summary #totalPrice {
        font-size: 20px;
        color: #c9a77c;
        font-weight: bold;
    }

    .cart-summary button {
        width: 100%;
        padding: 15px;
        background-color: #c9a77c;
        color: white;
        border: none;
        font-size: 16px;
        cursor: pointer;
        border-radius: 8px;
        transition: background-color 0.3s;
    }

    .cart-summary button:hover {
        background-color: #b68e5b;
    }

    /* Footer */
    footer {
        background-color: #1a1a1a;
        color: white;
        padding: 40px;
        font-size: 14px;
        text-align: center;
    }

    .footer-content {
        display: flex;
        justify-content: space-between;
        max-width: 1200px;
        margin: auto;
    }

    .footer-content ul {
        list-style: none;
        padding: 0;
    }

    .footer-content ul li a {
        color: #c9a77c;
        text-decoration: none;
        font-size: 14px;
        transition: color 0.3s ease;
    }

    .footer-content ul li a:hover {
        color: #fff;
    }

    @media (max-width: 768px) {
        .cart-container {
            grid-template-columns: 1fr;
        }
    }
  </style>
</head>
<body>

</style>


</head>
<body>
    <!--HEADER-->
    <!-- Navigation Bar -->
  <header>
    <div class="logo">
        <h1>SONIA EMPORIUM</h1>
    </div>
    <nav>
        <ul>
            <li><a href="index.html"><i class="fas fa-home"></i> Home</a></li>
            <li><a href="shop.html"><i class="fas fa-shopping-bag"></i> Shop</a></li>
            <li><a href="about.html"><i class="fas fa-info-circle"></i> About</a></li>
            <li><a href="contact.html"><i class="fas fa-phone"></i> Contact</a></li>
            <li><a href="account.html"><i class="fas fa-user"></i> My Account</a></li>
        </ul>
    </nav>
    <div class="cart">
        <a href="cart.html"><i class="fas fa-shopping-cart"></i> Cart </a>
    </div>
</header>
    </header>

  <!-- Cart Items Section -->
  <section id="cartSection">
    <h1>Your Shopping Cart</h1>
    <div id="cartItemsList"></div>
  </section>

  <!-- Cart Summary Section -->
  <section id="cartSummary">
    <h2>Order Summary</h2>
    <p id="subtotal">Subtotal: R0.00</p>
    <p id="deliveryFee">Delivery Fee (10%): R0.00</p>
    <h3 id="totalPrice">Total: R0.00</h3>
    <button id="checkoutButton">Proceed to Checkout</button>
  </section>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.1.2/firebase-app.js";
    import { getFirestore, collection, getDocs, doc, deleteDoc, updateDoc, setDoc } from "https://www.gstatic.com/firebasejs/9.1.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCTRQ7Jwg8ro4fGbNpRgY5Xri8KBUju_Cw",
      authDomain: "sonia-emporium-95984.firebaseapp.com",
      projectId: "sonia-emporium-95984",
      messagingSenderId: "582010973914",
      appId: "1:582010973914:web:3bbcc21cef1d15a997ffe3",
      measurementId: "G-72TR5RZVBB"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    let cartItems = [];
    let subtotal = 0;
    let totalQuantity = 0; // New variable to track total quantity

    const cartItemsList = document.getElementById('cartItemsList');
    const subtotalElem = document.getElementById('subtotal');
    const deliveryFeeElem = document.getElementById('deliveryFee');
    const totalPriceElem = document.getElementById('totalPrice');

    async function loadCartItems() {
      cartItemsList.innerHTML = '';
      subtotal = 0;
      totalQuantity = 0; // Reset total quantity

      const querySnapshot = await getDocs(collection(db, "cart"));
      cartItems = [];

      querySnapshot.forEach((doc) => {
        const item = { ...doc.data(), id: doc.id };
        cartItems.push(item);
        subtotal += item.price * (item.quantity || 1);
        totalQuantity += item.quantity || 1; // Add to total quantity
      });

      cartItems.forEach(item => {
        const cartItemElem = createCartItemElement(item);
        cartItemsList.appendChild(cartItemElem);
      });

      updateSummary();
    }

    function createCartItemElement(item) {
      const cartItemElem = document.createElement('div');
      cartItemElem.classList.add('cart-item');
      
      cartItemElem.innerHTML = `
        <img src="${item.image || 'default-image.jpg'}" alt="${item.name}">
        <div class="cart-item-details">
          <h4>${item.name}</h4>
          <p>Size: ${item.size}</p>
          <p>$${item.price}</p>
          <div class="quantity-toggle">
            <button onclick="changeQuantity('${item.id}', -1)">-</button>
            <span id="quantity-${item.id}">${item.quantity || 1}</span>
            <button onclick="changeQuantity('${item.id}', 1)">+</button>
          </div>
        </div>
        <button onclick="removeItem('${item.id}')">Remove</button>
      `;
      return cartItemElem;
    }

    async function updateSummary() {
      const deliveryFee = subtotal * 0.1;
      const total = subtotal + deliveryFee;

      subtotalElem.textContent = `Subtotal: R${subtotal.toFixed(2)}`;
      deliveryFeeElem.textContent = `Delivery Fee (10%): R${deliveryFee.toFixed(2)}`;
      totalPriceElem.textContent = `Total: R${total.toFixed(2)}`;

      // Update total price and quantity in Firestore
      await setDoc(doc(db, "cart", "cartSummary"), {
        totalPrice: total,
        totalQuantity: totalQuantity,
        subtotal: subtotal,
        deliveryFee: deliveryFee
      });
    }

    window.changeQuantity = async (itemId, change) => {
      const item = cartItems.find(item => item.id === itemId);
      if (!item) return;

      item.quantity = (item.quantity || 1) + change;
      if (item.quantity < 1) item.quantity = 1;

      document.getElementById(`quantity-${itemId}`).textContent = item.quantity;

      await updateDoc(doc(db, "cart", itemId), { quantity: item.quantity });
      subtotal += item.price * change;
      totalQuantity += change;
      updateSummary();
    };

    window.removeItem = async (itemId) => {
      const item = cartItems.find(item => item.id === itemId);
      if (item) {
        totalQuantity -= item.quantity || 1; // Subtract item quantity from total
        subtotal -= item.price * (item.quantity || 1);
      }

      await deleteDoc(doc(db, "cart", itemId));
      cartItems = cartItems.filter(item => item.id !== itemId);

      loadCartItems();
    };

    document.getElementById('checkoutButton').addEventListener('click', () => {
      alert("Proceeding to checkout...");
      window.location.href = 'checkout.html';
    });

    loadCartItems();
  </script>
</body>
</html>
